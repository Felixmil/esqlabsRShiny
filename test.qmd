---
title: "Package test"
execute: 
  warning: false
  eval: false
---

## Summary


## Package Installation


Looking for installation from [https://github.com/esqLABS/esqlabsR](https://github.com/esqLABS/esqlabsR). 

::: {.column-margin}
Why is the package not installable from github ?
:::


According to the Readme file, dependencies must be installed manually.

### rClr
```{r}
download.file("https://github.com/Open-Systems-Pharmacology/rClr/releases/download/v0.9.2/rClr_0.9.2.zip", "_data/rClr.zip")
install.packages("_data/rClr.zip", repos = NULL)
```

### OSPSuite.Rutils & TLF library
```{r}
library(remotes)
remotes::install_github("Open-Systems-Pharmacology/OSPSuite.RUtils")
remotes::install_github("Open-Systems-Pharmacology/TLF-Library")
```

### OSPSuite
```{r}
download.file("https://github.com/Open-Systems-Pharmacology/OSPSuite-R/releases/download/v11.0.123/ospsuite_11.0.123.zip", "_data/ospsuite.zip")
install.packages("_data/ospsuite.zip", repos = NULL)
```

### OSPSuite Parameter Identification
```{r}
remotes::install_github("Open-Systems-Pharmacology/OSPSuite.ParameterIdentification")
```

### esqLABSR 
```{r}
download.file("https://ci.appveyor.com/api/buildjobs/7k0p0h00kkcga9nv/artifacts/esqlabsR.zip", destfile = "_data/esqlabsR.zip")
install.packages("_data/esqlabsR.zip", repos = NULL)
```

::: {.column-margin}
What does all these dependencies do ?
:::

### Installation Verification

```{r, eval=TRUE, results='hold'}
library(esqlabsR)
library(ospsuite)
library(tlf)
library(rClr)
```
 
```{r,eval=T,results='hold'}
find.package("esqlabsR")
packageVersion("esqlabsR")
```

:::{.callout-warning}

esqLABS package wasn't easy to install. Some packages required to download zips and manually install, some can be installed directly from github. I had the chance to find how to install properly from zipfiles [here](https://github.com/Open-Systems-Pharmacology/OSPSuite-R#under-windows) (It didn't work with `devtools::install_local()` which I usually use). Clearer instructions should be available in the repo's README
:::

## Running the [Standard Workflow](https://esqlabs.github.io/esqlabsR/articles/standard-workflow.html)


:::{.callout-note}
Downloaded the whole esqlabsR package and put the `tests/data/TestProject/` files in `_data/TestProject/`
:::

```{r, eval = TRUE}
projectConfiguration <- createDefaultProjectConfiguration(path = "_data/TestProject/Code/ProjectConfiguration.xlsx")


projectConfiguration$dataFolder <- "_data/TestProject/Data/"
projectConfiguration$modelFolder <- "_data/TestProject/Models/"
projectConfiguration$paramsFolder <- "_data/TestProject/Parameters/"
projectConfiguration$outputFolder <- "_data/TestProject/Outputs/"

print(projectConfiguration)

```
::: {.column-margin}
These parameters should depend on a "master" directory.

:::

```{r, eval = TRUE}
sim <- loadSimulation(system.file("extdata", "Aciclovir.pkml", package = "ospsuite"))
applicationParams <- getAllApplicationParameters(sim)
applicationParams[1]
```


```{r, eval = TRUE}
scenarioConfigurations <- readScenarioConfigurationFromExcel(
  scenarioNames = "TestScenario",
  projectConfiguration = projectConfiguration
)

print(scenarioConfigurations$TestScenario)
```
```{r}
simulatedScenarios <- runScenarios(
  scenarioConfigurations = scenarioConfigurations,
  customParams = NULL, saveSimulationsToPKML = FALSE
)
```

::: {.column-margin}
got this error:

> Error in initPKSim() : 
> Could not find an installation of PK-Sim on the machine. Please install the OSPSuite or use 'initPKSim()' to specify the installation path

:::
